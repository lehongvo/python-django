{% extends 'store/base.html' %}

{% load store_filters %}
{% block title %}{{ site_name }} - Premium E-commerce Platform{% endblock %}

{% block content %}
<!-- Voucher Popup -->
<div id="voucherOverlay" class="voucher-popup-overlay">
    <div id="voucherPopup" class="voucher-popup">
        <button id="closeVoucherBtn" class="voucher-popup-close" aria-label="Close">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="voucher-popup-content">
            <!-- Animated Icon -->
            <div class="voucher-popup-icon">
                <div class="voucher-icon-circle">
                    <div class="voucher-icon-inner">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div class="voucher-sparkles">
                        <span class="sparkle sparkle-1">✨</span>
                        <span class="sparkle sparkle-2">✨</span>
                        <span class="sparkle sparkle-3">✨</span>
                        <span class="sparkle sparkle-4">✨</span>
                    </div>
                </div>
            </div>
            
            <!-- Title with Animated Count -->
            <h3 class="voucher-popup-title">
                You have 
                <span id="voucherCount" class="voucher-count-highlight">
                    <span class="count-number">0</span>
                </span> 
                active voucher<span id="voucherPlural">s</span>!
            </h3>
            
            <!-- Message -->
            <p class="voucher-popup-message">
                Don't miss out on exclusive savings! Use your vouchers now to get amazing discounts on premium products.
            </p>
            
            <!-- CTA Button -->
            <button id="useVoucherBtn" class="voucher-popup-btn">
                <span class="btn-text">Shop Now & Save</span>
                <i class="fas fa-arrow-right btn-icon"></i>
                <div class="btn-shine"></div>
            </button>
            
            <!-- Close Link -->
            <button class="voucher-popup-link" onclick="document.getElementById('voucherOverlay').classList.remove('active'); document.getElementById('voucherPopup').classList.remove('active');">
                Maybe later
            </button>
        </div>
        
        <div class="voucher-popup-decoration">
            <div class="voucher-decoration-circle circle-1"></div>
            <div class="voucher-decoration-circle circle-2"></div>
            <div class="voucher-decoration-circle circle-3"></div>
        </div>
    </div>
</div>

<!-- Hero Section -->
<section class="premium-hero">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute inset-0" style="background-image: radial-gradient(circle at 20% 50%, white 0%, transparent 50%), radial-gradient(circle at 80% 80%, white 0%, transparent 50%);"></div>
    </div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24 md:py-32">
        <div class="grid lg:grid-cols-2 gap-12 items-center">
            <!-- Left Content -->
            <div class="premium-hero-content text-white">
                <div class="inline-block premium-glass px-6 py-3 rounded-full mb-6 animate-fade-in">
                    <span class="text-sm font-bold flex items-center">
                        <i class="fas fa-check-circle mr-2"></i>Trusted by 50,000+ customers
                    </span>
                </div>
                
                <h1 class="premium-hero-title animate-fade-in-up animate-delay-100">
                    Shop the Best
                    <span class="highlight">Premium Products</span>
                    Online
            </h1>
                
                <p class="premium-hero-subtitle animate-fade-in-up animate-delay-200">
                    Discover exceptional quality products with unbeatable prices. 
                    Fast shipping, secure checkout, and 24/7 support.
            </p>
                
                <div class="premium-cta-group animate-fade-in-up animate-delay-300">
                    <a href="{% url 'store:product_list' %}" class="premium-cta-primary">
                        <i class="fas fa-shopping-bag"></i>
                        <span>Shop Now</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                    <a href="{% url 'store:category_list' %}" class="premium-cta-secondary">
                        <i class="fas fa-th-large"></i>
                        <span>Browse Categories</span>
                </a>
                </div>
                
                <!-- Trust Indicators -->
                <div class="premium-trust-badges animate-fade-in-up animate-delay-400">
                    <div class="premium-trust-badge">
                        <div class="premium-trust-badge-icon">
                            <i class="fas fa-shipping-fast"></i>
                        </div>
                        <div class="premium-trust-badge-content">
                            <h3>Free Shipping</h3>
                            <p>On orders over $100</p>
                        </div>
                    </div>
                    <div class="premium-trust-badge">
                        <div class="premium-trust-badge-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="premium-trust-badge-content">
                            <h3>Secure Payment</h3>
                            <p>SSL encrypted</p>
                        </div>
            </div>
        </div>
    </div>
    
            <!-- Right - Featured Product Carousel -->
            {% if featured_products %}
            <div class="relative">
                <div class="premium-carousel-card">
                    <!-- Product Carousel -->
                    <div id="productCarousel" class="carousel-container">
                        {% for product in featured_products|slice:":20" %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}" data-product-id="{{ product.id }}">
                            <div class="premium-carousel-image">
                                {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                                {% else %}
                                <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-indigo-50 to-purple-50">
                                    <i class="fas fa-image text-6xl text-indigo-300"></i>
                                </div>
                                {% endif %}
                                <!-- Overlay for discount badge -->
                                {% if product.computed_discount_percent > 0 %}
                                <div class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold shadow-lg">
                                    {{ product.computed_discount_percent|floatformat:0 }}% OFF
                                </div>
                                {% endif %}
                                <!-- Quick actions overlay -->
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                                    <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex space-x-2">
                                        <a href="{% url 'store:product_detail' product.slug %}" class="bg-white text-gray-800 px-4 py-2 rounded-full text-sm font-semibold hover:bg-gray-100 transition-colors">
                                            <i class="fas fa-eye mr-1"></i>Quick View
                                        </a>
                                        {% if user.is_authenticated %}
                                        <button type="button" onclick="addToCart({{ product.id }})" class="bg-indigo-600 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-indigo-700 transition-colors">
                                            <i class="fas fa-shopping-cart mr-1"></i>Add
                                        </button>
                                        {% else %}
                                        <a href="/login/?next={{ request.path }}" class="bg-indigo-600 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-indigo-700 transition-colors inline-flex items-center">
                                            <i class="fas fa-shopping-cart mr-1"></i>Add
                                        </a>
                                        {% endif %}
                                        <button type="button" data-product-id="{{ product.id }}" class="bg-white text-gray-800 px-4 py-2 rounded-full text-sm font-semibold hover:bg-gray-100 transition-colors add-to-wishlist-btn">
                                            <i class="fas fa-heart mr-1"></i>Wishlist
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="flex items-center gap-2">
                                    {% for i in "12345" %}
                                    <i class="fas fa-star text-yellow-400"></i>
                                    {% endfor %}
                                    <span class="text-gray-600 text-sm ml-2">(4.9) {{ product.stock|add:1000 }}+ reviews</span>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-900 line-clamp-2">{{ product.name }}</h3>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-baseline gap-2">
                                        <span class="text-3xl font-bold text-indigo-600">{{ product.price|format_vnd }}</span>
                                        {% if product.compare_price %}
                                        <span class="text-gray-400 line-through">{{ product.compare_price|format_vnd }}</span>
                                        {% endif %}
                                    </div>
                                    <a href="{% url 'store:product_detail' product.slug %}" class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all transform hover:scale-105">
                                        View Details
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Carousel Indicators -->
                    <div class="flex justify-center flex-wrap gap-2 mt-6 max-w-full">
                        {% for product in featured_products|slice:":20" %}
                        <button class="carousel-indicator w-2 h-2 rounded-full {% if forloop.first %}bg-indigo-600{% else %}bg-gray-300{% endif %} transition-colors" data-slide="{{ forloop.counter0 }}"></button>
                        {% endfor %}
                    </div>
                </div>
    </div>
            {% endif %}
    </div>
    </div>
</section>

<!-- Stats Section -->
<section class="py-20 bg-white border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div class="premium-stat-card">
                <div class="premium-stat-number">{{ featured_products|length }}+</div>
                <div class="premium-stat-label">Featured Products</div>
            </div>
            <div class="premium-stat-card">
                <div class="premium-stat-number">{{ categories|length }}+</div>
                <div class="premium-stat-label">Categories</div>
            </div>
            <div class="premium-stat-card">
                <div class="premium-stat-number">24/7</div>
                <div class="premium-stat-label">Support</div>
            </div>
            <div class="premium-stat-card">
                <div class="premium-stat-number">50K+</div>
                <div class="premium-stat-label">Happy Customers</div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Products -->
{% if featured_products %}
<section class="py-20 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="premium-section-title">
            <h2>
                <i class="fas fa-star text-yellow-500 mr-3"></i>
                <span class="title-gradient">Featured Products</span>
            </h2>
            <p>
                Discover our handpicked selection of premium products, carefully curated for the modern lifestyle.
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for product in featured_products %}
            {% include 'store/components/product_card.html' with product=product show_description=True %}
            {% endfor %}
        </div>
        
        <div class="text-center mt-12">
            <a href="{% url 'store:product_list' %}" class="btn-modern text-lg px-8 py-4">
                <i class="fas fa-arrow-right mr-2"></i>View All Products
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Categories Section -->
{% if categories %}
<section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-gray-900 mb-4 section-title">
                <i class="fas fa-th-large text-indigo-500 mr-3"></i>Shop by Category
            </h2>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                Explore our diverse range of categories, each offering unique products tailored to your needs.
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for category in categories %}
            <div class="group cursor-pointer">
                <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-8 text-center hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                    <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform">
                        <i class="fas fa-{{ category.name|lower|slice:':1' }} text-white text-2xl"></i>
                    </div>
                    
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">{{ category.name }}</h3>
                    <p class="text-gray-600 mb-6">{{ category.description|truncatewords:15 }}</p>
                    
                    <div class="flex items-center justify-center space-x-4 mb-6">
                        <span class="bg-indigo-100 text-indigo-600 px-3 py-1 rounded-full text-sm font-semibold">
                            {{ category.product_set.count }} products
                        </span>
                        <span class="text-gray-500 text-sm">
                            <i class="fas fa-clock mr-1"></i>Updated daily
                        </span>
                    </div>
                    
                    <a href="{% url 'store:product_list' %}?category={{ category.slug }}" 
                       class="inline-flex items-center text-indigo-600 font-semibold hover:text-indigo-700 transition-colors">
                        Browse {{ category.name }}
                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Category Pagination -->
        <div class="flex justify-between items-center mt-10">
            <div class="text-sm text-gray-600">
                Page {{ cat_page_obj.number }} of {{ cat_paginator.num_pages }}
            </div>
            <div class="flex items-center space-x-2">
                {% if cat_page_obj.has_previous %}
                <a href="?cat_page={{ cat_page_obj.previous_page_number }}&cat_limit={{ cat_limit }}"
                   class="px-4 py-2 bg-white border rounded-xl hover:bg-gray-50">Prev</a>
                {% else %}
                <span class="px-4 py-2 bg-gray-100 border rounded-xl text-gray-400">Prev</span>
                {% endif %}
                {% if cat_page_obj.has_next %}
                <a href="?cat_page={{ cat_page_obj.next_page_number }}&cat_limit={{ cat_limit }}"
                   class="px-4 py-2 bg-white border rounded-xl hover:bg-gray-50">Next</a>
                {% else %}
                <span class="px-4 py-2 bg-gray-100 border rounded-xl text-gray-400">Next</span>
                {% endif %}
            </div>
            <form method="get">
                <input type="hidden" name="cat_page" value="1">
                <label class="text-sm text-gray-600 mr-2">Per row</label>
                <select name="cat_limit" class="px-3 py-2 border rounded-xl" onchange="this.form.submit()">
                    {% for n in cat_limits %}
                    <option value="{{ n }}" {% if cat_limit == n %}selected{% endif %}>{{ n }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>
</section>
{% endif %}

<!-- Features Section -->
<section class="py-20 bg-gray-900 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <h2 class="text-4xl font-bold mb-4">
                Why Choose TechStore 2025?
            </h2>
            <p class="text-xl text-gray-300 max-w-2xl mx-auto">
                Experience the next generation of e-commerce with our cutting-edge platform.
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="text-center">
                <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-rocket text-white text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">Lightning Fast</h3>
                <p class="text-gray-300">
                    Experience blazing-fast page loads and instant responses with our optimized platform.
                </p>
            </div>
            
            <div class="text-center">
                <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-shield-alt text-white text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">Secure & Safe</h3>
                <p class="text-gray-300">
                    Your data and transactions are protected with enterprise-grade security measures.
                </p>
            </div>
            
            <div class="text-center">
                <div class="w-16 h-16 bg-gradient-to-r from-orange-500 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-headset text-white text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">24/7 Support</h3>
                <p class="text-gray-300">
                    Get help whenever you need it with our round-the-clock customer support team.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Newsletter Section - E-commerce Style -->
<section class="bg-gray-900 py-16 md:py-24 relative overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute inset-0" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.05) 20px);"></div>
    </div>
    
    <!-- Gradient Orbs -->
    <div class="absolute top-0 left-0 w-96 h-96 bg-blue-500 rounded-full filter blur-3xl opacity-20"></div>
    <div class="absolute bottom-0 right-0 w-96 h-96 bg-purple-500 rounded-full filter blur-3xl opacity-20"></div>
    
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl border border-gray-700 shadow-2xl overflow-hidden">
            <div class="grid md:grid-cols-2 gap-0">
                <!-- Left Side - Content -->
                <div class="p-8 md:p-12 flex flex-col justify-center">
                    <div class="inline-flex items-center gap-2 bg-green-500/10 border border-green-500/30 rounded-full px-4 py-2 mb-6 w-fit">
                        <i class="fas fa-rocket text-green-400"></i>
                        <span class="text-green-400 text-sm font-semibold">Limited Time Offer</span>
                    </div>
                    
                    <h2 class="text-4xl md:text-5xl font-black text-white mb-4 leading-tight">
                        Don't Miss Out on
                        <span class="bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                            Exclusive Deals
                        </span>
                    </h2>
                    
                    <p class="text-gray-300 text-lg mb-8 leading-relaxed">
                        Join 50,000+ subscribers and get access to <strong class="text-white">flash sales</strong>, 
                        <strong class="text-white">new product launches</strong>, and <strong class="text-white">member-only discounts</strong>.
                    </p>
                    
                    <!-- Stats -->
                    <div class="flex flex-wrap gap-6 mb-8">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                            <span class="text-gray-300 text-sm"><strong class="text-white">50K+</strong> Subscribers</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                            <span class="text-gray-300 text-sm"><strong class="text-white">24/7</strong> Support</span>
                        </div>
                    </div>
                    
                    <!-- Trust Badges -->
                    <div class="flex items-center gap-6 text-sm text-gray-400">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-check-circle text-green-400"></i>
                            <span>Instant delivery</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-shield-alt text-blue-400"></i>
                            <span>100% Secure</span>
                        </div>
                    </div>
                </div>
                
                <!-- Right Side - Form -->
                <div class="bg-gradient-to-br from-gray-800 to-gray-900 border-l border-gray-700 p-8 md:p-12 flex flex-col justify-center">
                    <form id="newsletter-form">
                        <div class="space-y-4">
                            <div>
                                <label for="newsletter-email" class="block text-sm font-semibold text-gray-300 mb-2">
                                    Email Address
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-envelope text-gray-400"></i>
                                    </div>
                                    <input 
                                        type="email" 
                                        id="newsletter-email" 
                                        required
                                        placeholder="you@example.com"
                                        class="block w-full pl-12 pr-4 py-4 border border-gray-600 bg-gray-700/50 text-white placeholder-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                </div>
                            </div>
                            
                            <button 
                                type="submit" 
                                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg hover:shadow-blue-500/50 transform hover:scale-[1.02] flex items-center justify-center gap-2">
                                <span>Subscribe Now</span>
                                <i class="fas fa-arrow-right"></i>
                </button>
                            
                            <div id="newsletter-message" class="text-center"></div>
                            
                            <p class="text-xs text-gray-500 text-center">
                                <i class="fas fa-lock text-green-400"></i>
                                We respect your privacy. Unsubscribe at any time.
                            </p>
                        </div>
            </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// Get cookie (for CSRF)
function getCookie(name){
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
// Wishlist Buttons
document.addEventListener('DOMContentLoaded', function() {
    const wishlistButtons = document.querySelectorAll('.add-to-wishlist-btn');
    wishlistButtons.forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            addToWishlist(productId);
        });
    });
});

// Newsletter Form with Email Validation
document.getElementById('newsletter-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const email = document.getElementById('newsletter-email').value;
    const messageDiv = document.getElementById('newsletter-message');
    const button = this.querySelector('button[type="submit"]');
    const emailInput = document.getElementById('newsletter-email');
    
    // Clear previous messages
    messageDiv.innerHTML = '';
    emailInput.classList.remove('border-red-500', 'border-green-500');
    
    // Email validation regex
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    if (!email) {
        messageDiv.innerHTML = '<div class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm"><i class="fas fa-exclamation-circle mr-2"></i>Please enter your email address</div>';
        emailInput.classList.add('border-red-500');
        return;
    }
    
    if (!emailRegex.test(email)) {
        messageDiv.innerHTML = '<div class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm"><i class="fas fa-exclamation-circle mr-2"></i>Please enter a valid email address</div>';
        emailInput.classList.add('border-red-500');
        return;
    }
    
    // Valid email - proceed with subscription
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Subscribing...';
    
    // Submit to backend
    fetch('/subscribe/', {
        method: 'POST',
        headers: { 
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: new URLSearchParams({ email })
    }).then(async (res) => {
        const data = await res.json().catch(()=>({}));
        if (res.ok) {
            messageDiv.innerHTML = '<div class="bg-green-500 text-white px-4 py-2 rounded-lg text-sm"><i class="fas fa-check-circle mr-2"></i>' + (data.message || 'Thanks for subscribing!') + '</div>';
        document.getElementById('newsletter-email').value = '';
        } else {
            messageDiv.innerHTML = '<div class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm"><i class="fas fa-exclamation-circle mr-2"></i>' + (data.error || 'Subscription failed') + '</div>';
        }
    }).catch(() => {
        messageDiv.innerHTML = '<div class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm"><i class="fas fa-exclamation-circle mr-2"></i>Subscription failed. Please try again later.</div>';
    }).finally(()=>{
        button.disabled = false;
        button.innerHTML = '<span>Subscribe Now</span><i class="fas fa-arrow-right"></i>';
        setTimeout(()=>{ messageDiv.innerHTML=''; }, 5000);
    });
});

// Real-time email validation
document.getElementById('newsletter-email').addEventListener('input', function() {
    const email = this.value;
    const messageDiv = document.getElementById('newsletter-message');
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    if (email.length > 0 && !emailRegex.test(email)) {
        this.classList.add('border-red-500');
        this.classList.remove('border-gray-300');
    } else {
        this.classList.remove('border-red-500');
        this.classList.add('border-gray-300');
        if (messageDiv.innerHTML.includes('red-500')) {
            messageDiv.innerHTML = '';
        }
    }
});

// Product Carousel
document.addEventListener('DOMContentLoaded', function() {
    const carouselItems = document.querySelectorAll('.carousel-item');
    const indicators = document.querySelectorAll('.carousel-indicator');
    let currentSlide = 0;
    
    if (carouselItems.length === 0) return;
    
    function showSlide(index) {
        // Hide all slides
        carouselItems.forEach(item => item.classList.remove('active'));
        indicators.forEach(indicator => {
            indicator.classList.remove('bg-indigo-600');
            indicator.classList.add('bg-gray-300');
        });
        
        // Show current slide
        if (carouselItems[index]) {
            carouselItems[index].classList.add('active');
        }
        if (indicators[index]) {
            indicators[index].classList.remove('bg-gray-300');
            indicators[index].classList.add('bg-indigo-600');
        }
        
        currentSlide = index;
    }
    
    function nextSlide() {
        const nextIndex = (currentSlide + 1) % carouselItems.length;
        showSlide(nextIndex);
    }
    
    // Auto-advance every 1.5 seconds
    if (carouselItems.length > 1) {
        setInterval(nextSlide, 1500);
    }
    
    // Manual navigation with indicators
    indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
            showSlide(index);
        });
    });
});

// Voucher Popup
document.addEventListener('DOMContentLoaded', function() {
    const voucherPopup = document.getElementById('voucherPopup');
    const voucherOverlay = document.getElementById('voucherOverlay');
    const voucherCountEl = document.getElementById('voucherCount');
    const useVoucherBtn = document.getElementById('useVoucherBtn');
    const closeVoucherBtn = document.getElementById('closeVoucherBtn');
    
    // Debug: Check if elements exist
    if (!voucherPopup || !voucherOverlay) {
        console.error('Voucher popup elements not found!');
        return;
    }
    
    // Check if user has seen popup in this session (only after closing)
    // Comment out for testing - uncomment later
    // const popupShown = sessionStorage.getItem('voucherPopupShown');
    // if (popupShown) {
    //     return;
    // }
    
    // Fetch voucher count from API
    async function fetchVoucherCount() {
        try {
            const apiUrl = '{% url "store:voucher_count_api" %}';
            console.log('Fetching voucher count from:', apiUrl);
            
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                },
                credentials: 'same-origin'
            });
            
            console.log('API Response status:', response.status);
            
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            
            const data = await response.json();
            console.log('Voucher count received:', data);
            return data.count || 0;
        } catch (error) {
            console.error('Error fetching voucher count:', error);
            return 0;
        }
    }
    
    // Show popup function
    async function showVoucherPopup() {
        const count = await fetchVoucherCount();
        console.log('Voucher count:', count);
        
        // Always show popup for testing (remove || true after testing)
        if (count > 0 || true) {
            if (voucherCountEl) {
                const countNumber = voucherCountEl.querySelector('.count-number');
                if (countNumber) {
                    countNumber.textContent = count > 0 ? count : 'X';
                } else {
                    voucherCountEl.textContent = count > 0 ? count : 'X';
                }
                
                // Update plural
                const pluralEl = document.getElementById('voucherPlural');
                if (pluralEl) {
                    pluralEl.textContent = count === 1 ? '' : 's';
                }
            }
            
            // Show popup after 1.5 seconds delay
            setTimeout(() => {
                console.log('Showing popup now...', {
                    overlay: voucherOverlay,
                    popup: voucherPopup,
                    overlayClasses: voucherOverlay.className,
                    popupClasses: voucherPopup.className
                });
                
                if (voucherOverlay && voucherPopup) {
                    voucherOverlay.classList.add('active');
                    voucherPopup.classList.add('active');
                    
                    // Force show for debugging
                    voucherOverlay.style.opacity = '1';
                    voucherOverlay.style.visibility = 'visible';
                    voucherOverlay.style.pointerEvents = 'auto';
                    voucherPopup.style.opacity = '1';
                    voucherPopup.style.visibility = 'visible';
                    
                    console.log('Popup should be visible now');
                } else {
                    console.error('Elements missing when trying to show popup');
                }
                // sessionStorage.setItem('voucherPopupShown', 'true');
            }, 1500);
        } else {
            console.log('No vouchers found, not showing popup');
        }
    }
    
    // Close popup function
    function closeVoucherPopup() {
        voucherOverlay.classList.remove('active');
        voucherPopup.classList.remove('active');
    }
    
    // Navigate to products page
    function goToProducts() {
        window.location.href = '{% url "store:product_list" %}';
    }
    
    // Event listeners
    if (useVoucherBtn) {
        useVoucherBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeVoucherPopup();
            goToProducts();
        });
    }
    
    if (closeVoucherBtn) {
        closeVoucherBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeVoucherPopup();
        });
    }
    
    // Close on overlay click
    if (voucherOverlay) {
        voucherOverlay.addEventListener('click', function(e) {
            if (e.target === voucherOverlay) {
                closeVoucherPopup();
            }
        });
    }
    
    // Close on ESC key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && voucherPopup.classList.contains('active')) {
            closeVoucherPopup();
        }
    });
    
    // Initialize popup
    showVoucherPopup();
});

</script>
{% endblock %}

{% block extra_css %}
<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .animate-fade-in {
        animation: fadeIn 0.6s ease-out;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Carousel Styles */
    .carousel-container {
        position: relative;
        overflow: hidden;
        min-height: 400px;
    }
    
    .carousel-item {
        display: none;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
    }
    
    .carousel-item.active {
        display: block;
        opacity: 1;
    }
    
    .carousel-indicator {
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .carousel-indicator:hover {
        background-color: #6366f1 !important;
    }
    
    /* ===================================
       VOUCHER POPUP - Premium Professional Design
       =================================== */
    .voucher-popup-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(12px);
        z-index: 99999;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        visibility: hidden;
        transition: all 400ms cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
        animation: overlayFadeIn 0.4s ease-out;
    }
    
    @keyframes overlayFadeIn {
        from {
            opacity: 0;
            backdrop-filter: blur(0px);
        }
        to {
            opacity: 1;
            backdrop-filter: blur(12px);
        }
    }
    
    .voucher-popup-overlay.active {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }
    
    .voucher-popup {
        position: relative;
        background: linear-gradient(145deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%);
        border-radius: 32px;
        max-width: 520px;
        width: 100%;
        box-shadow: 
            0 25px 50px -12px rgba(0, 0, 0, 0.25),
            0 0 0 1px rgba(255, 255, 255, 0.1),
            0 0 80px rgba(102, 126, 234, 0.15);
        overflow: hidden;
        transform: scale(0.85) translateY(30px) rotateX(10deg);
        opacity: 0;
        transition: all 500ms cubic-bezier(0.34, 1.56, 0.64, 1);
        border: 2px solid rgba(255, 255, 255, 0.9);
        perspective: 1000px;
    }
    
    .voucher-popup.active {
        transform: scale(1) translateY(0) rotateX(0deg);
        opacity: 1;
        animation: popupEntrance 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    @keyframes popupEntrance {
        0% {
            transform: scale(0.8) translateY(50px) rotateX(15deg);
            opacity: 0;
        }
        60% {
            transform: scale(1.05) translateY(-5px) rotateX(-2deg);
        }
        100% {
            transform: scale(1) translateY(0) rotateX(0deg);
            opacity: 1;
        }
    }
    
    .voucher-popup-close {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.04);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6b7280;
        font-size: 18px;
        transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10;
    }
    
    .voucher-popup-close:hover {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        transform: rotate(90deg) scale(1.1);
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    .voucher-popup-content {
        padding: 56px 40px 40px;
        text-align: center;
        position: relative;
        z-index: 2;
    }
    
    .voucher-popup-icon {
        margin-bottom: 32px;
        position: relative;
    }
    
    .voucher-icon-circle {
        width: 120px;
        height: 120px;
        margin: 0 auto;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        box-shadow: 
            0 20px 40px -10px rgba(102, 126, 234, 0.4),
            0 0 0 8px rgba(102, 126, 234, 0.1),
            inset 0 2px 10px rgba(255, 255, 255, 0.3);
        animation: voucher-icon-float 3s ease-in-out infinite;
        overflow: visible;
    }
    
    @keyframes voucher-icon-float {
        0%, 100% {
            transform: translateY(0) scale(1);
            box-shadow: 
                0 20px 40px -10px rgba(102, 126, 234, 0.4),
                0 0 0 8px rgba(102, 126, 234, 0.1);
        }
        50% {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 
                0 30px 60px -10px rgba(102, 126, 234, 0.5),
                0 0 0 12px rgba(102, 126, 234, 0.15);
        }
    }
    
    .voucher-icon-inner {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 42px;
        color: white;
        animation: voucher-icon-rotate 4s linear infinite;
    }
    
    @keyframes voucher-icon-rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .voucher-sparkles {
        position: absolute;
        inset: 0;
        pointer-events: none;
    }
    
    .sparkle {
        position: absolute;
        font-size: 24px;
        animation: sparkle-float 2s ease-in-out infinite;
        opacity: 0.8;
    }
    
    .sparkle-1 {
        top: -10px;
        left: 20%;
        animation-delay: 0s;
    }
    
    .sparkle-2 {
        top: 10%;
        right: -5px;
        animation-delay: 0.5s;
    }
    
    .sparkle-3 {
        bottom: 10%;
        left: -5px;
        animation-delay: 1s;
    }
    
    .sparkle-4 {
        bottom: -10px;
        right: 20%;
        animation-delay: 1.5s;
    }
    
    @keyframes sparkle-float {
        0%, 100% {
            transform: translate(0, 0) scale(1) rotate(0deg);
            opacity: 0.8;
        }
        50% {
            transform: translate(10px, -10px) scale(1.2) rotate(180deg);
            opacity: 1;
        }
    }
    
    .voucher-popup-title {
        font-size: 32px;
        font-weight: 900;
        color: #111827;
        margin-bottom: 16px;
        line-height: 1.2;
        letter-spacing: -0.8px;
        animation: titleSlideIn 0.6s ease-out 0.2s both;
    }
    
    @keyframes titleSlideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .voucher-count-highlight {
        display: inline-block;
        position: relative;
        margin: 0 4px;
    }
    
    .count-number {
        font-size: 48px;
        font-weight: 900;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        display: inline-block;
        animation: countPulse 1s ease-in-out infinite;
        text-shadow: 0 0 30px rgba(102, 126, 234, 0.3);
        position: relative;
    }
    
    @keyframes countPulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.1);
        }
    }
    
    #voucherPlural {
        font-size: 32px;
    }
    
    .voucher-popup-message {
        font-size: 17px;
        color: #4b5563;
        margin-bottom: 36px;
        line-height: 1.7;
        max-width: 420px;
        margin-left: auto;
        margin-right: auto;
        animation: messageSlideIn 0.6s ease-out 0.4s both;
    }
    
    @keyframes messageSlideIn {
        from {
            opacity: 0;
            transform: translateY(15px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .voucher-popup-btn {
        width: 100%;
        padding: 18px 36px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        background-size: 200% 100%;
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 18px;
        font-weight: 800;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-bottom: 20px;
        transition: all 400ms cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 
            0 12px 30px -8px rgba(102, 126, 234, 0.5),
            0 0 0 1px rgba(255, 255, 255, 0.1) inset,
            0 0 40px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
        animation: buttonSlideIn 0.6s ease-out 0.6s both;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    @keyframes buttonSlideIn {
        from {
            opacity: 0;
            transform: translateY(20px) scale(0.95);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    .voucher-popup-btn:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 
            0 20px 40px -8px rgba(102, 126, 234, 0.6),
            0 0 0 1px rgba(255, 255, 255, 0.2) inset,
            0 0 60px rgba(102, 126, 234, 0.4);
        background-position: 100% 0;
    }
    
    .voucher-popup-btn:active {
        transform: translateY(-1px) scale(0.98);
    }
    
    .voucher-popup-btn .btn-text {
        position: relative;
        z-index: 2;
    }
    
    .voucher-popup-btn .btn-icon {
        position: relative;
        z-index: 2;
        transition: transform 300ms ease;
    }
    
    .voucher-popup-btn:hover .btn-icon {
        transform: translateX(4px);
    }
    
    .btn-shine {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.6s ease;
    }
    
    .voucher-popup-btn:hover .btn-shine {
        left: 100%;
    }
    
    .voucher-popup-link {
        background: none;
        border: none;
        color: #9ca3af;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        padding: 10px 16px;
        transition: all 300ms ease;
        text-decoration: none;
        border-radius: 8px;
    }
    
    .voucher-popup-link:hover {
        color: #6b7280;
        background: rgba(0, 0, 0, 0.04);
    }
    
    .voucher-popup-decoration {
        position: absolute;
        inset: 0;
        overflow: hidden;
        pointer-events: none;
        z-index: 1;
    }
    
    .voucher-decoration-circle {
        position: absolute;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    }
    
    .voucher-decoration-circle.circle-1 {
        width: 200px;
        height: 200px;
        top: -100px;
        right: -100px;
    }
    
    .voucher-decoration-circle.circle-2 {
        width: 150px;
        height: 150px;
        bottom: -75px;
        left: -75px;
    }
    
    .voucher-decoration-circle.circle-3 {
        width: 100px;
        height: 100px;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
    }
    
    /* Responsive */
    @media (max-width: 640px) {
        .voucher-popup {
            max-width: 90%;
            border-radius: 20px;
        }
        
        .voucher-popup-content {
            padding: 40px 24px 24px;
        }
        
        .voucher-popup-title {
            font-size: 24px;
        }
        
        .voucher-count-highlight {
            font-size: 28px;
        }
        
        .voucher-icon-circle {
            width: 64px;
            height: 64px;
            font-size: 28px;
        }
    }
    
</style>
{% endblock %}